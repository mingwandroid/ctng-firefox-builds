From 7c951833f14216fad32fd3c6bd6fb30f113f70dd Mon Sep 17 00:00:00 2001
From: Martell <martellmalone@gmail.com>
Date: Sun, 17 Nov 2013 22:17:50 +0000
Subject: [PATCH] Updated to latest, need to rename Go Lang vars

preceded by ..

Update to hg 3252:7e569a9cb5fd
---
 config/cc.in                              | 14 +++++++++
 config/cc/gcc.in                          |  7 +++++
 config/debug/gdb.in                       | 15 ++++++++++
 config/kernel/linux.in                    | 49 +++++++++++--------------------
 config/libc/eglibc.in                     |  8 +++++
 config/libc/glibc-eglibc.in-common        |  5 ++++
 config/libc/glibc.in                      | 12 ++++++++
 scripts/build/cc/100-gcc.sh               |  1 +
 scripts/build/debug/300-gdb.sh            |  4 +--
 scripts/build/libc/eglibc.sh              |  5 ++++
 scripts/build/libc/glibc-eglibc.sh-common |  2 +-
 scripts/build/libc/glibc.sh               |  5 ++++
 scripts/crosstool-NG.sh.in                |  3 ++
 scripts/functions                         |  2 +-
 scripts/showSamples.sh                    |  1 +
 15 files changed, 97 insertions(+), 36 deletions(-)

diff --git a/config/cc.in b/config/cc.in
index d072a8a..ab2ee4d 100644
--- a/config/cc.in
+++ b/config/cc.in
@@ -32,6 +32,9 @@ config CC_SUPPORT_OBJC
 config CC_SUPPORT_OBJCXX
     bool
 
+config CC_SUPPORT_GOLANG
+    bool
+
 comment "Additional supported languages:"
 
 config CC_LANG_CXX
@@ -99,6 +102,17 @@ config CC_LANG_OBJCXX
       Only select this if you know that your specific version of the
       compiler supports this language.
 
+config CC_LANG_GOLANG
+    bool
+    prompt "Go (EXPERIMENTAL)"
+    depends on EXPERIMENTAL
+    depends on CC_SUPPORT_GOLANG
+    help
+      Enable building a Go compiler.
+
+      Only select this if you know that your specific version of the
+      compiler supports this language.
+
 config CC_LANG_OTHERS
     string
     prompt "Other languages (EXPERIMENTAL)"
diff --git a/config/cc/gcc.in b/config/cc/gcc.in
index af511a9..e917524 100644
--- a/config/cc/gcc.in
+++ b/config/cc/gcc.in
@@ -59,6 +59,11 @@ config CC_GCC_V_linaro_4_8
     depends on CC_GCC_SHOW_LINARO
     select CC_GCC_4_8
 
+config CC_GCC_V_4_8_2
+    bool
+    prompt "4.8.2"
+    select CC_GCC_4_8
+
 config CC_GCC_V_4_8_1
     bool
     prompt "4.8.1"
@@ -362,6 +367,7 @@ config CC_GCC_4_8
     select CC_GCC_HAS_BUILD_ID
     select CC_GCC_HAS_LNK_HASH_STYLE
     select CC_GCC_HAS_LIBQUADMATH
+    select CC_SUPPORT_GOLANG
 
 config CC_GCC_4_8_or_later
     bool
@@ -472,6 +478,7 @@ config CC_GCC_VERSION
 # Don't remove next line
 # CT_INSERT_VERSION_STRING_BELOW
     default "5666.3" if CC_GCC_V_apple_5666_3 
+    default "4.8.2" if CC_GCC_V_4_8_2
     default "linaro-4.8-2013.06-1" if CC_GCC_V_linaro_4_8
     default "4.8.1" if CC_GCC_V_4_8_1
     default "4.8.0" if CC_GCC_V_4_8_0
diff --git a/config/debug/gdb.in b/config/debug/gdb.in
index 835ddd1..03799cb 100644
--- a/config/debug/gdb.in
+++ b/config/debug/gdb.in
@@ -33,6 +33,13 @@ choice
 # Don't remove next line
 # CT_INSERT_VERSION_BELOW
 
+
+config GDB_V_7_6_1
+    bool
+    prompt "7.6.1"
+    select GDB_7_0_or_later
+    select GDB_7_2_or_later
+
 config GDB_V_linaro_7_6_2013_05
     bool
     prompt "linaro-7.6-2013.05"
@@ -40,6 +47,12 @@ config GDB_V_linaro_7_6_2013_05
     select GDB_7_0_or_later
     select GDB_7_2_or_later
 
+config GDB_V_7_5_1
+    bool
+    prompt "7.5.1"
+    select GDB_7_0_or_later
+    select GDB_7_2_or_later
+
 config GDB_V_linaro_7_5_2012_12_1
     bool
     prompt "linaro-7.5-2012.12-1"
@@ -144,7 +157,9 @@ config GDB_VERSION
     string
 # Don't remove next line
 # CT_INSERT_VERSION_STRING_BELOW
+    default "7.6.1" if GDB_V_7_6_1
     default "linaro-7.6-2013.05" if GDB_V_linaro_7_6_2013_05
+    default "7.5.1" if GDB_V_7_5_1
     default "linaro-7.5-2012.12-1" if GDB_V_linaro_7_5_2012_12_1
     default "linaro-7.4-2012.06" if GDB_V_linaro_7_4_2012_06
     default "7.4.1" if GDB_V_7_4_1
diff --git a/config/kernel/linux.in b/config/kernel/linux.in
index 44037b1..df6b7b7 100644
--- a/config/kernel/linux.in
+++ b/config/kernel/linux.in
@@ -26,29 +26,17 @@ choice
 # Don't remove next line
 # CT_INSERT_VERSION_BELOW
 
-config KERNEL_V_3_11_4
+config KERNEL_V_3_12
     bool
-    prompt "3.11.4"
-
-config KERNEL_V_3_11_3
-    bool
-    prompt "3.11.3"
-
-config KERNEL_V_3_11_2
-    bool
-    prompt "3.11.2"
-
-config KERNEL_V_3_11_1
-    bool
-    prompt "3.11.1"
+    prompt "3.12"
 
 config KERNEL_V_3_11
     bool
-    prompt "3.11"
+    prompt "3.11.8"
 
 config KERNEL_V_3_10
     bool
-    prompt "3.10.15"
+    prompt "3.10.19"
 
 config KERNEL_V_3_9
     bool
@@ -56,7 +44,7 @@ config KERNEL_V_3_9
 
 config KERNEL_V_3_8
     bool
-    prompt "3.8.13"
+    prompt "3.8.13.9"
 
 config KERNEL_V_3_7
     bool
@@ -68,11 +56,11 @@ config KERNEL_V_3_6
 
 config KERNEL_V_3_5
     bool
-    prompt "3.5.7"
+    prompt "3.5.7.25"
 
 config KERNEL_V_3_4
     bool
-    prompt "3.4.65"
+    prompt "3.4.69"
 
 config KERNEL_V_3_3
     bool
@@ -80,7 +68,7 @@ config KERNEL_V_3_3
 
 config KERNEL_V_3_2
     bool
-    prompt "3.2.51"
+    prompt "3.2.52"
 
 config KERNEL_V_3_1
     bool
@@ -88,7 +76,7 @@ config KERNEL_V_3_1
 
 config KERNEL_V_3_0
     bool
-    prompt "3.0.99"
+    prompt "3.0.101"
 
 config KERNEL_V_2_6_39
     bool
@@ -179,22 +167,19 @@ config KERNEL_VERSION
     string
 # Don't remove next line
 # CT_INSERT_VERSION_STRING_BELOW
-    default "3.11.4" if KERNEL_V_3_11_4
-    default "3.11.3" if KERNEL_V_3_11_3
-    default "3.11.2" if KERNEL_V_3_11_2
-    default "3.11.1" if KERNEL_V_3_11_1
-    default "3.11" if KERNEL_V_3_11
-    default "3.10.15" if KERNEL_V_3_10
+    default "3.12" if KERNEL_V_3_12
+    default "3.11.8" if KERNEL_V_3_11
+    default "3.10.19" if KERNEL_V_3_10
     default "3.9.11" if KERNEL_V_3_9
-    default "3.8.13" if KERNEL_V_3_8
+    default "3.8.13.9" if KERNEL_V_3_8
     default "3.7.10" if KERNEL_V_3_7
     default "3.6.11" if KERNEL_V_3_6
-    default "3.5.7" if KERNEL_V_3_5
-    default "3.4.65" if KERNEL_V_3_4
+    default "3.5.7.25" if KERNEL_V_3_5
+    default "3.4.69" if KERNEL_V_3_4
     default "3.3.8" if KERNEL_V_3_3
-    default "3.2.51" if KERNEL_V_3_2
+    default "3.2.52" if KERNEL_V_3_2
     default "3.1.10" if KERNEL_V_3_1
-    default "3.0.99" if KERNEL_V_3_0
+    default "3.0.101" if KERNEL_V_3_0
     default "2.6.39.4" if KERNEL_V_2_6_39
     default "2.6.38.8" if KERNEL_V_2_6_38
     default "2.6.37.6" if KERNEL_V_2_6_37
diff --git a/config/libc/eglibc.in b/config/libc/eglibc.in
index 2f05861..ea6d7bf 100644
--- a/config/libc/eglibc.in
+++ b/config/libc/eglibc.in
@@ -32,35 +32,43 @@ config LIBC_EGLIBC_V_2_17
 config LIBC_EGLIBC_V_2_16
     bool
     prompt "2_16"
+    select LIBC_GLIBC_PORTS_EXTERNAL
     select LIBC_EGLIBC_2_16_or_later
 
 config LIBC_EGLIBC_V_2_15
     bool
     prompt "2_15"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_EGLIBC_V_2_14
     bool
     prompt "2_14"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_EGLIBC_V_2_13
     bool
     prompt "2_13"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_EGLIBC_V_2_12
     bool
     prompt "2_12"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_EGLIBC_V_2_11
     bool
     prompt "2_11"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_EGLIBC_V_2_10
     bool
     prompt "2_10"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_EGLIBC_V_2_9
     bool
     prompt "2_9"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_EGLIBC_V_TRUNK
     bool
diff --git a/config/libc/glibc-eglibc.in-common b/config/libc/glibc-eglibc.in-common
index f27101c..6c5d2f0 100644
--- a/config/libc/glibc-eglibc.in-common
+++ b/config/libc/glibc-eglibc.in-common
@@ -4,6 +4,11 @@
 # Some architectures require the ports addon. List them one by one here:
 # This list must be carefully in sync with the architectures names
 # we can find in config/arch/*
+
+config LIBC_GLIBC_PORTS_EXTERNAL
+    bool
+    default n
+
 config LIBC_GLIBC_MAY_FORCE_PORTS
     bool
     default y if ARCH_arm
diff --git a/config/libc/glibc.in b/config/libc/glibc.in
index 15bbce1..3fe7522 100644
--- a/config/libc/glibc.in
+++ b/config/libc/glibc.in
@@ -25,51 +25,63 @@ config LIBC_GLIBC_V_2_17
 config LIBC_GLIBC_V_2_16_0
     bool
     prompt "2.16.0"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_GLIBC_V_2_15
     bool
     prompt "2.15"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_GLIBC_V_2_14_1
     bool
     prompt "2.14.1"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_GLIBC_V_2_14
     bool
     prompt "2.14"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_GLIBC_V_2_13
     bool
     prompt "2.13"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_GLIBC_V_2_12_2
     bool
     prompt "2.12.2"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_GLIBC_V_2_12_1
     bool
     prompt "2.12.1"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_GLIBC_V_2_11_1
     bool
     prompt "2.11.1"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_GLIBC_V_2_11
     bool
     prompt "2.11"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_GLIBC_V_2_10_1
     bool
     prompt "2.10.1"
+    select LIBC_GLIBC_PORTS_EXTERNAL
     select LIBC_GLIBC_USE_PORTS
 
 config LIBC_GLIBC_V_2_9
     bool
     prompt "2.9"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 config LIBC_GLIBC_V_2_8
     bool
     prompt "2.8"
+    select LIBC_GLIBC_PORTS_EXTERNAL
 
 endchoice
 
diff --git a/scripts/build/cc/100-gcc.sh b/scripts/build/cc/100-gcc.sh
index 46ab3cb..ede8cc5 100644
--- a/scripts/build/cc/100-gcc.sh
+++ b/scripts/build/cc/100-gcc.sh
@@ -74,6 +74,7 @@ cc_gcc_lang_list() {
     [ "${CT_CC_LANG_JAVA}" = "y"     ] && lang_list+=",java"
     [ "${CT_CC_LANG_OBJC}" = "y"     ] && lang_list+=",objc"
     [ "${CT_CC_LANG_OBJCXX}" = "y"   ] && lang_list+=",obj-c++"
+    [ "${CT_CC_LANG_GOLANG}" = "y"   ] && lang_list+=",go"
     lang_list+="${CT_CC_LANG_OTHERS:+,${CT_CC_LANG_OTHERS}}"
 
     printf "%s" "${lang_list}"
diff --git a/scripts/build/debug/300-gdb.sh b/scripts/build/debug/300-gdb.sh
index 0490943..5d67b6a 100644
--- a/scripts/build/debug/300-gdb.sh
+++ b/scripts/build/debug/300-gdb.sh
@@ -146,8 +146,8 @@ do_debug_gdb_build() {
         CC_for_gdb=
         LD_for_gdb=
         if [ "${CT_GDB_CROSS_STATIC}" = "y" ]; then
-            CC_for_gdb="gcc -static"
-            LD_for_gdb="ld -static"
+            CC_for_gdb="${CT_HOST}-gcc -static"
+            LD_for_gdb="${CT_HOST}-ld -static"
         fi
 
         CT_DoLog DEBUG "Extra config passed: '${cross_extra_config[*]}'"
diff --git a/scripts/build/libc/eglibc.sh b/scripts/build/libc/eglibc.sh
index 37f837a..6ba7e43 100644
--- a/scripts/build/libc/eglibc.sh
+++ b/scripts/build/libc/eglibc.sh
@@ -42,6 +42,11 @@ do_libc_get() {
             nptl)   continue;;
         esac
 
+        case "${CT_LIBC_GLIBC_PORTS_EXTERNAL}" in
+            y)   ;;
+            *)   continue;;
+        esac
+
         if ! CT_GetSVN "eglibc-${addon}-${CT_LIBC_VERSION}" \
                        "${svn_base}/${addon}"               \
                        "${CT_EGLIBC_REVISION:-HEAD}"
diff --git a/scripts/build/libc/glibc-eglibc.sh-common b/scripts/build/libc/glibc-eglibc.sh-common
index c01e671..b9c55cb 100644
--- a/scripts/build/libc/glibc-eglibc.sh-common
+++ b/scripts/build/libc/glibc-eglibc.sh-common
@@ -304,7 +304,7 @@ do_libc_backend_once() {
     fi
 
     # Pre-seed the configparms file with values from the config option
-    printf "${CT_LIBC_GLIBC_CONFIGPARMS}\n" > configparms
+    printf "%s\n" "${CT_LIBC_GLIBC_CONFIGPARMS}" > configparms
 
     cross_cc=$(CT_Which "${CT_TARGET}-gcc")
     extra_cc_args+=" ${extra_flags}"
diff --git a/scripts/build/libc/glibc.sh b/scripts/build/libc/glibc.sh
index 6323c7c..896432f 100644
--- a/scripts/build/libc/glibc.sh
+++ b/scripts/build/libc/glibc.sh
@@ -32,6 +32,11 @@ do_libc_get() {
             nptl)   continue;;
         esac
 
+        case "${CT_LIBC_GLIBC_PORTS_EXTERNAL}" in
+            y)   ;;
+            *)   continue;;
+        esac
+
         if ! CT_GetFile "glibc-${addon}-${CT_LIBC_VERSION}"     \
                         {ftp,http}://ftp.gnu.org/gnu/glibc      \
                         ftp://gcc.gnu.org/pub/glibc/releases    \
diff --git a/scripts/crosstool-NG.sh.in b/scripts/crosstool-NG.sh.in
index 1543cd9..3c98b8c 100644
--- a/scripts/crosstool-NG.sh.in
+++ b/scripts/crosstool-NG.sh.in
@@ -154,6 +154,9 @@ CT_DoBuildTargetTuple
 # Sanity check some directories
 CT_TestAndAbort "'CT_PREFIX_DIR' is not set: where should I install?" -z "${CT_PREFIX_DIR}"
 
+# Avoid multiple '/' in the prefix dir, it breaks relocatability
+CT_PREFIX_DIR="$( "${sed}" -r -e 's:/+:/:g; s:/*$::;' <<<"${CT_PREFIX_DIR}" )"
+
 # Second kludge: merge user-supplied target CFLAGS with architecture-provided
 # target CFLAGS. Do the same for LDFLAGS in case it happens in the future.
 # Put user-supplied flags at the end, so that they take precedence.
diff --git a/scripts/functions b/scripts/functions
index 776b6b8..92b3033 100644
--- a/scripts/functions
+++ b/scripts/functions
@@ -1358,7 +1358,7 @@ CT_DoLoadState(){
     CT_DoLog STATE "  Restoring log file"
     exec >/dev/null
     case "${CT_DEBUG_CT_SAVE_STEPS_GZIP}" in
-        y)  zcat "${state_dir}/log.gz" >"${tmp_log_file}";;
+        y)  gzip -dc "${state_dir}/log.gz" >"${tmp_log_file}";;
         *)  cat "${state_dir}/log" >"${tmp_log_file}";;
     esac
     cat "${state_dir}/tail.log" >>"${tmp_log_file}"
diff --git a/scripts/showSamples.sh b/scripts/showSamples.sh
index 7c6d373..d04919a 100755
--- a/scripts/showSamples.sh
+++ b/scripts/showSamples.sh
@@ -83,6 +83,7 @@ dump_single_sample() {
             [ "${CT_CC_LANG_ADA}" = "y"     ] && printf ",ADA"
             [ "${CT_CC_LANG_OBJC}" = "y"    ] && printf ",Objective-C"
             [ "${CT_CC_LANG_OBJCXX}" = "y"  ] && printf ",Objective-C++"
+            [ "${CT_CC_LANG_GOLANG}" = "y"  ] && printf ",Go"
             [ -n "${CT_CC_LANG_OTHERS}"     ] && printf ",${CT_CC_LANG_OTHERS}"
             printf ")\n"
             printf  "    %-*s : %s (threads: %s)\n" ${width} "C library" "${CT_LIBC}${CT_LIBC_VERSION:+-}${CT_LIBC_VERSION}" "${CT_THREADS}"
-- 
1.8.4.3

