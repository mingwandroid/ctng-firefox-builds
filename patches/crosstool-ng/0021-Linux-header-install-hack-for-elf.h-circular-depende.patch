From fae3439c489080ffb4d8982cfac00952266f9947 Mon Sep 17 00:00:00 2001
From: Ray Donnelly <mingw.android@gmail.com>
Date: Wed, 22 Jan 2014 01:47:35 +0000
Subject: [PATCH 21/21] Linux header install hack for elf.h circular dependency

Fix from Arnaud Dovi:

https://github.com/diorcety/crosstool-ng/issues/11#

"
I think I have found the root cause of this elf.h issue

Its a circular dependency problem

  __headers: $(version_h) scripts_basic asm-generic archheaders archscripts FORCE
      $(Q)$(MAKE) $(build)=scripts build_unifdef

  PHONY += headers_install
  headers_install: __headers
      $(if $(wildcard $(srctree)/arch/$(hdr-arch)/include/uapi/asm/Kbuild),, \
        $(error Headers not exportable for the $(SRCARCH) architecture))
      $(Q)$(MAKE) $(hdr-inst)=include/uapi
      $(Q)$(MAKE) $(hdr-inst)=arch/$(hdr-arch)/include/uapi/asm $(hdr-dst)

In short headers_install depends on archscripts but archscripts compiles a code
with a header elf.h installed by headers_install

Next once you fix this you will realize the headers are copied under linux\elf.h
of the sysroot when the code looks for elf.h
"
---
 ...30-disable-archscripts-due-to-elf_h-circular-dep.patch | 15 +++++++++++++++
 1 file changed, 15 insertions(+)
 create mode 100644 patches/linux/3.12/130-disable-archscripts-due-to-elf_h-circular-dep.patch

diff --git a/patches/linux/3.12/130-disable-archscripts-due-to-elf_h-circular-dep.patch b/patches/linux/3.12/130-disable-archscripts-due-to-elf_h-circular-dep.patch
new file mode 100644
index 0000000..39da0a6
--- /dev/null
+++ b/patches/linux/3.12/130-disable-archscripts-due-to-elf_h-circular-dep.patch
@@ -0,0 +1,15 @@
+diff -urN a/linux/3.12.8/140-kernel-disable-archscripts.patch b/linux/3.12.8/140-kernel-disable-archscripts.patch
+--- a/linux/3.12.8/140-kernel-disable-archscripts.patch	1970-01-01 01:00:00.000000000 +0100
++++ b/linux/3.12.8/140-kernel-disable-archscripts.patch	2014-01-22 01:41:16.055083900 +0000
+@@ -0,0 +1,11 @@
++--- linux-3.12.8/Makefile.orig	2014-01-16 00:31:56.000000000 +0100
+++++ linux-3.12.8/Makefile	2014-01-20 00:03:25.961403100 +0100
++@@ -906,7 +906,7 @@
++ archscripts:
++ 
++ PHONY += __headers
++-__headers: $(version_h) scripts_basic asm-generic archheaders archscripts FORCE
+++__headers: $(version_h) scripts_basic asm-generic archheaders FORCE
++ 	$(Q)$(MAKE) $(build)=scripts build_unifdef
++ 
++ PHONY += headers_install_all
-- 
1.8.5.3

